<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link th:href="@{/css/navbar.css}" rel="stylesheet">
    <style>
        table {
            border-spacing: 0;
            width: 100%;
            border: 1px solid #ddd;
        }

        th, td {
            text-align: left;

        }

        tr:nth-child(even) {
            background-color: #f2f2f2
        }
    </style>
    <script src="https://code.jquery.com/jquery-3.7.1.js"></script>
   <!-- <script type="text/javascript" th:src="@{/javascript/tableProperties.js}"></script> -->
    <!--
    <script>
        function searchFunction() {
        // declare variables
        let input, filter, table, tr, td, i, textValue;
        input = document.getElementById('myInput');
        filter = input.value.toUpperCase();
        table = document.getElementById('lease_table');
        tr = table.getElementsByTagName('tr');

        // loop through all the table rows, and hide those who don't match the search query
        for (i = 0; i < tr.length; i++) {
            td = tr[i].getElementsByTagName('td')[0];
            if (td) {
                textValue = td.textContent || td.innerText;
                if (textValue.toUpperCase().indexOf(filter) > -1) {
                    tr[i].style.display = "";
                } else {
                    tr[i].style.display = 'none';
                }
            }
        }
    }
    </script>
    -->
    <!--
    <link href = "../static/css/datatables.css" th:href="@{/css/datatables.css}" rel="stylesheet">
    <script src="https://cdn.datatables.net/2.3.0/js/dataTables.js"></script>
    -->
</head>
<body>
<header th:replace="~{fragments.html :: navbar}"></header>

<!--
<div class="container">
<div class="form-container">
    <h2> Opret en ny bil </h2>
    <form class="form2" th:action="@{/createCar}" method="post">
        <label for="car-model-id">Model id:</label>
        <input type="text" id="car-model-id" name="car-model-id" placeholder="Indtast bilens model id" required>

        <label for="vin-number">Stelnummer:</label>
        <input type="text" id="vin-number" name="vin-number" placeholder="Indtast bilens stelnummer" required>

        <label for="color">Indtast bilens farve:</label>
        <input type="text" id="color" name="color" placeholder="Indtast bilens farve" required>

        <button type="submit"> Opret bil </button>

    </form>
</div>
</div>
-->

<label for="tableSelector">Choose a table:</label>
<select id="tableSelector">
    <option value="lease" th:if="${session.loggedInUser.getRoleValue().equalsIgnoreCase('ADMIN') ||
                                   session.loggedInUser.getRoleValue().equalsIgnoreCase('DATA_RECORDING')}">
        Leasingaftaler
    </option>
    <option value="lease_inactive" th:if="${session.loggedInUser.getRoleValue().equalsIgnoreCase('ADMIN') ||
                                   session.loggedInUser.getRoleValue().equalsIgnoreCase('DATA_RECORDING')}">
        Færdige leasingaftaler
    </option>
    <option value="car" th:if="${!session.loggedInUser.getRoleValue().equalsIgnoreCase('BUSINESS_DEVELOPER')}">
        Biler
    </option>
    <option value="condition_report" th:if="${session.loggedInUser.getRoleValue().equalsIgnoreCase('ADMIN') ||
                                   session.loggedInUser.getRoleValue().equalsIgnoreCase('MECHANIC')}">
        Tilstandsrapporter
    </option>
    <option value="damage" th:if="${session.loggedInUser.getRoleValue().equalsIgnoreCase('ADMIN') ||
                                   session.loggedInUser.getRoleValue().equalsIgnoreCase('MECHANIC')}">
        Skader
    </option>
    <option value="employee" th:if="${session.loggedInUser.getRoleValue().equalsIgnoreCase('ADMIN')}">
        Ansatte
    </option>
    <option value="purchase_agreements" th:if="${session.loggedInUser.getRoleValue().equalsIgnoreCase('ADMIN') ||
                                   session.loggedInUser.getRoleValue().equalsIgnoreCase('DATA_RECORDING')}">
        Købsaftaler
    </option>
    <option value="customer">
        Kunder
    </option>
</select>


<div class="dataTable" id="lease">
<h2>Aktive leasing aftaler</h2>
    <input type="text" id="tableSearch" placeholder="Search..">

    <table id="lease_table">
        <thead>
        <tr>
            <th onclick="sortTable(0)">Lease detaljer</th>
            <th onclick="sortTable(1)">Vehicle Id</th>
            <th onclick="sortTable(2)">Customer Id</th>
            <th onclick="sortTable(3)">Lease Type</th>
            <th onclick="sortTable(4)">Lease Price</th>
            <th onclick="sortTable(5)">Lease Start Date</th>
            <th onclick="sortTable(6)">Lease End Date</th>
            <th onclick="sortTable(7)">Return Location</th>
            <th onclick="sortTable(8)">Delete</th>
        </tr>
        </thead>

        <tbody>
        <tr th:each= "leaseAgreement: ${leaseAgreements}" th:if="${leaseAgreement.active}">
            <td>
                <form th:action="@{/leaseDetails}" method="get">
                    <input type="hidden" th:value="${leaseAgreement.leaseAgreementId}" name="lease_agreement_id">
                    <button type="submit"> Vis lease </button>
                </form>
                <td th:text="${leaseAgreement.fkVehicleId}" />
                <td th:text="${leaseAgreement.getCustomer().getCustomerId()}" />
                <td th:text="${leaseAgreement.leaseType}" />
                <td th:text="${leaseAgreement.leasePrice}" />
                <td th:text="${leaseAgreement.leaseStartDate}" />
                <td th:text="${leaseAgreement.leaseEndDate}" />
                <td th:text="${leaseAgreement.returnLocation}" />
            <td>
                <form th:action="@{/deleteLease}" method="post">
                    <input type="hidden" name="lease_agreement_id" th:value="${leaseAgreement.leaseAgreementId}">
                    <button type="submit">Delete</button>
                </form>
            </td>
        </tr>
        </tbody>
    </table>
    <form th:action="@{/createLeasePage}" method="get">
        <button type="submit">Create Lease</button>
    </form>

</div>

<div class="dataTable" id="lease_inactive">
<h2>Inaktive leasing aftaler</h2>
    <table id="lease_inactive_table">
        <thead>
        <tr>
            <th onclick="sortTable(0)">Lease detaljer</th>
            <th onclick="sortTable(1)">Vehicle Id</th>
            <th onclick="sortTable(2)">Customer Id</th>
            <th onclick="sortTable(3)">Lease Type</th>
            <th onclick="sortTable(4)">Lease Price</th>
            <th onclick="sortTable(5)">Lease Start Date</th>
            <th onclick="sortTable(6)">Lease End Date</th>
            <th onclick="sortTable(7)">Return Location</th>
            <th onclick="sortTable(8)">Delete</th>
        </tr>
        </thead>

        <tbody>
        <tr th:each= "leaseAgreement: ${leaseAgreements}" th:if="${!leaseAgreement.active}">
            <td>
                <form th:action="@{/leaseDetails}" method="get">
                    <input type="hidden" th:value="${leaseAgreement.leaseAgreementId}" name="lease_agreement_id">
                    <button type="submit"> Vis lease </button>
                </form>
            </td>
            <td th:text="${leaseAgreement.fkVehicleId}" />
            <td th:text="${leaseAgreement.getCustomer().getCustomerId()}" />
            <td th:text="${leaseAgreement.leaseType}" />
            <td th:text="${leaseAgreement.leasePrice}" />
            <td th:text="${leaseAgreement.leaseStartDate}" />
            <td th:text="${leaseAgreement.leaseEndDate}" />
            <td th:text="${leaseAgreement.returnLocation}" />
            <td>
                <form th:action="@{/deleteLease}" method="post">
                    <input type="hidden" name="lease_agreement_id" th:value="${leaseAgreement.leaseAgreementId}">
                    <button type="submit">Delete</button>
                </form>
            </td>
        </tr>
        </tbody>
    </table>
</div>

<div class="dataTable" id="car">
<h2>Biler</h2>
    <table id="car_table">
        <thead>
            <tr>
                <th onclick="sortTable(0)">ID</th>
                <th onclick="sortTable(1)">VIN Number</th>
                <th onclick="sortTable(2)">Mærke</th>
                <th onclick="sortTable(3)">Model</th>
                <th onclick="sortTable(4)">Udstyr</th>
                <th onclick="sortTable(5)">Farve</th>
                <th onclick="sortTable(6)">Forkøbt</th>
                <th onclick="sortTable(7)">Status</th>
                <th onclick="sortTable(8)">Tilstandsrapport</th>
                <th onclick="sortTable(9)">Slet bil</th>
            </tr>
        </thead>
        <tbody>
            <tr th:each="car: ${cars}">
                <td th:text="${car.getVehicleId()}" />
                <td th:text="${car.vinNumber}" />
                <td th:text="${car.getCarModel().getBrand()}" />
                <td th:text="${car.getCarModel().getModelName()}" />
                <td th:text="${car.getCarModel().getCarEquipment()}" />
                <td th:text="${car.color}" />
                <td th:text="${car.bought}" />
                <td>
                    <form th:action="@{/updateCarStatus}" method="post">
                        <select name="status">
                            <option value="READY" th:selected="${car.status.name() == 'READY'}">Klar</option>
                            <option value="DAMAGED" th:selected="${car.status.name() == 'DAMAGED'}">Skadet</option>
                            <option value="GETTING_REPAIRED" th:selected="${car.status.name() == 'GETTING_REPAIRED'}">På værksted</option>
                            <option value="RENTED" th:selected="${car.status.name() == 'RENTED'}">Udlejet</option>
                        </select>
                        <input type="hidden" name="vehicle_id" th:value="${car.vehicleId}">
                        <button type="submit">Opdater status </button>
                    </form>
                </td>
                <td>   <!-- Below statement checks whether there is a condition report for said vehicle ID, and prints
                        a different button, depending on whether or not there is-->
                    <div th:if="${conditionReportsMap[car.vehicleId] != null}">
                        <form th:action="@{/condition-report}" method="get">
                            <input type="hidden" name="condition_report_id"
                                   th:value="${conditionReportsMap[car.vehicleId].conditionReportId}" />
                            <button type="submit">Rediger tilstandsrapport</button>
                        </form>
                    </div>
                    <div th:unless="${conditionReportsMap[car.vehicleId] != null}">
                        <form th:action="@{/createConditionReport}" method="post">
                            <input type="hidden" name="vehicle_id" th:value="${car.vehicleId}" />
                            <button type="submit"> Opret tilstandsrapport </button>
                        </form>
                    </div>
                </td>
                <td>
                    <form th:action="@{/deleteCar}" method="post">
                        <input type="hidden" name="vehicleId" th:value="${car.vehicleId}">
                        <button type="submit">Delete</button>
                    </form>
                </td>
            </tr>
        </tbody>
    </table>
</div>

<div class="dataTable" id="condition_report">
<h2>Tilstandsrapporter</h2>
    <table id="condition_report_table">
        <thead>
        <tr>
            <th onclick="sortTable(0)">ID</th>
            <th onclick="sortTable(1)">Handler</th>
            <th onclick="sortTable(2)">Dato</th>
            <th onclick="sortTable(3)">Delete</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="conditionReport: ${conditionReports}">
            <td th:text="${conditionReport.conditionReportId}" />
            <td th:text="${conditionReport.handledBy}" />
            <td th:text="${conditionReport.reportDate}" />
            <td>
                <form th:action="@{/deleteConditionReport}" method="post">
                    <input type="hidden" name="condition_report_id" th:value="${conditionReport.conditionReportId}">
                    <button type="submit">Delete</button>
                </form>
            </td>
        </tr>
        </tbody>
    </table>
</div>

<div class="dataTable" id="damage">
<h2>Skader</h2>
    <table id="damage_table">
        <thead>
        <tr>
            <th onclick="sortTable(0)">ID</th>
            <th onclick="sortTable(1)">Tilstandsrapport-ID</th>
            <th onclick="sortTable(2)">Pris</th>
            <th onclick="sortTable(3)">Type skade</th>
            <th onclick="sortTable(4)">Delete</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="damage: ${damages}">
            <td th:text="${damage.damageId}" />
            <td th:text="${damage.conditionReportId}" />
            <td th:text="${damage.damagePrice}" />
            <td th:text="${damage.damageType}" />
            <td>
                <form th:action="@{/deleteDamage}" method="post">
                    <input type="hidden" name="damageId" th:value="${damage.damageId}">
                    <button type="submit">Delete</button>
                </form>
            </td>
        </tr>
        </tbody>
    </table>
</div>

<div class="dataTable" id="employee">
<h2>Ansatte</h2>
    <table id="employee_table">
        <thead>
        <tr>
            <th onclick="sortTable(0)">ID</th>
            <th onclick="sortTable(1)">Fornavn</th>
            <th onclick="sortTable(2)">Efternavn</th>
            <th onclick="sortTable(3)">Shortname</th>
            <th onclick="sortTable(4)">Email</th>
            <th onclick="sortTable(5)">Rolle</th>
            <th onclick="sortTable(6)">Delete</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="employee: ${employees}">
            <td th:text="${employee.employeeId}" />
            <td th:text="${employee.firstName}" />
            <td th:text="${employee.lastName}" />
            <td th:text="${employee.shortName}" />
            <td th:text="${employee.email}" />
            <td th:text="${employee.getRole()}" />
            <td>
                <form th:action="@{/deleteEmployee}" method="post">
                    <input type="hidden" name="empployeeId" th:value="${employee.employeeId}">
                    <button type="submit">Delete</button>
                </form>
            </td>
        </tr>
        </tbody>
    </table>
</div>

<div class="dataTable" id="purchase_agreements">
<h2>Købsaftaler</h2>
    <table id="purchase_agreements_table">
        <thead>
        <tr>
            <th onclick="sortTable(0)">ID</th>
            <th onclick="sortTable(1)">Kunde id</th>
            <th onclick="sortTable(2)">Bil id</th>
            <th onclick="sortTable(3)">Pris</th>
            <th onclick="sortTable(4)">Betalt?</th>
            <th onclick="sortTable(5)">Delete</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="purchaseAgreement: ${purchaseAgreements}">
            <td th:text="${purchaseAgreement.purchaseAgreementId}" />
            <td th:text="${purchaseAgreement.fkCustomerId}" />
            <td th:text="${purchaseAgreement.fkVehicleId}" />
            <td th:text="${purchaseAgreement.carPrice}" />
            <td th:text="${purchaseAgreement.paid}" />
            <td>
                <form th:action="@{/deletePurchaseAgreement}" method="post">
                    <input type="hidden" name="purchaseAgreementId" th:value="${purchaseAgreement.purchaseAgreementId}">
                    <button type="submit">Delete</button>
                </form>
            </td>
        </tr>
        </tbody>
    </table>
</div>

<div class="dataTable" id="customer">
    <table id="customer_table">
        <h2>Kunder</h2>
        <thead>
        <tr>
            <th onclick="sortTable(0)">ID</th>
            <th onclick="sortTable(1)">Fornavn</th>
            <th onclick="sortTable(2)">Efternavn</th>
            <th onclick="sortTable(3)">Email</th>
            <th onclick="sortTable(4)">Cpr-nummer</th>
            <th onclick="sortTable(5)">TelefonNummer</th>
            <th onclick="sortTable(6)">Adresse</th>
            <th onclick="sortTable(7)">By</th>
            <th onclick="sortTable(8)">Postnummer</th>
            <th onclick="sortTable(9)">Bil id</th>
            <th onclick="sortTable(10)">Delete</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="customer: ${customers}">
            <td th:text="${customer.customerId}" />
            <td th:text="${customer.firstName}" />
            <td th:text="${customer.lastName}" />
            <td th:text="${customer.email}" />
            <td th:text="${customer.cprNumber}" />
            <td th:text="${customer.phoneNumber}" />
            <td th:text="${customer.address}" />
            <td th:text="${customer.city}" />
            <td th:text="${customer.postalCode}" />
            <td th:text="${customer.fkVehicleId}" />
            <td>
                <form th:action="@{/deleteCustomer}" method="post">
                    <input type="hidden" name="customerId" th:value="${customer.customerId}">
                    <button type="submit">Delete</button>
                </form>
            </td>
        </tr>
        </tbody>
    </table>
</div>
</body>

<script>
    let tableId;
    $(document).ready(function () {
        // Cache the table selector
        const tableSelector = $('#tableSelector');

        // Initially hide all tables
        $('.dataTable').hide();

        // Show and initialize the default table
        tableId = tableSelector.val();
        $('#' + tableId).show();

        // On table selection change
        tableSelector.on('change', function ()  {
            tableId = $(this).val();

            // Hide all tables
            $('.dataTable').hide();

            // Show the selected table
            $('#' + tableId).show();
            console.log(tableId);
        });
    });

    function sortTable(n) {
        console.log('clicked')
        let table, rows, switching, i, x, y, shouldSwitch, dir, switchCount = 0;
        table = document.getElementById(`${tableId}_table`);
        console.log(table);
        switching = true;
        // Set the sorting direction to ascending:
        dir = "asc";

        // Make a loop that will continue until no switching has been done:
        while (switching) {
            // Start by saying: no switching is done:
            switching = false;
            rows = table.rows;
            /* Loop through all table rows (except the
            first, which contains table headers): */
            for (i = 1; i < (rows.length - 1); i++) {
                // Start by saying there should be no switching:
                shouldSwitch = false;
                // Get the two elements you want to compare, one from current row and one from the next:
                x = rows[i].getElementsByTagName("td")[n];
                y = rows[i + 1].getElementsByTagName("td")[n];

                //console.log(Number(x.innerHTML));
                if (Number(x.innerHTML)) {
                    console.log('number')
                }
                // Check if the two rows should switch place, based on the direction, asc or desc:
                if (dir === "asc") {
                    if (Number(x.innerHTML)){
                        if (Number(x.innerHTML) > Number(y.innerHTML)) {
                            // If so, mark as a switch and break the loop:
                            shouldSwitch = true;
                            break;
                        }
                    } else {
                        if (x.innerHTML.toLowerCase() > y.innerHTML.toLowerCase()) {
                            // If so, mark as a switch and break the loop:
                            shouldSwitch = true;
                            break;
                        }
                    }
                } else if (dir === "desc") {
                    if (Number(x.innerHTML)){
                        if (Number(x.innerHTML) < Number(y.innerHTML)) {
                            // If so, mark as a switch and break the loop:
                            shouldSwitch = true;
                            break;
                        }
                    } else {
                        if (x.innerHTML.toLowerCase() < y.innerHTML.toLowerCase()) {
                            // If so, mark as a switch and break the loop:
                            shouldSwitch = true;
                            break;
                        }
                    }
                }
            }
            if (shouldSwitch) {
                // If a switch has been marked, make the switch and mark that a switch has been done:
                rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
                switching = true;
                // Each time a switch is done, increase this count by 1:
                switchCount ++;
            } else {
                /* If no switching has been done AND the direction is "asc",
                set the direction to "desc" and run the while loop again. */
                if (switchCount === 0 && dir === "asc") {
                    dir = "desc";
                    switching = true;
                }
            }
        }
    }
</script>
</html>